import{e as Z,g as Ie,i as Te}from"./chunk-H3N4X3MO.js";import{a as W}from"./chunk-BS6CDHGN.js";import{a as ke}from"./chunk-MCQSURPA.js";import{$ as _,$a as Le,E as _e,Ea as Ce,Ga as Ae,Ka as N,Ma as z,Pa as be,Ra as a,S as oe,T as ge,V as he,Va as Pe,Wa as $,_ as F,a as fe,aa as g,b as ie,ba as xe,bb as ne,eb as q,fb as J,ga as re,hb as se,ia as L,la as ae,oa as x,ob as Q,pa as ye,qb as $e,y as Fe}from"./chunk-3ZWTIYMJ.js";import{Aa as D,C as p,Fc as k,Gc as ve,Ha as A,Ia as I,La as U,Mb as C,Mc as G,Na as de,Nc as H,Oc as h,Qb as M,R as ue,Sb as T,a as B,ac as d,b as w,d as pe,fc as V,gc as K,ic as E,ja as f,jc as j,kc as l,lc as v,ma as ce,mc as y,nc as O,oc as R,qa as ee,qc as b,sc as P,ta as te,tc as s,wa as n,zb as u}from"./chunk-5NRRMIXO.js";var me={};pe(me,{addFavouriteFilm:()=>Ne,closedFavouriteFilms:()=>He,deleteAllFavourites:()=>qe,deleteFavouriteFilm:()=>ze,deleteFavouritesByMediaType:()=>Je,loadFavouriteFilms:()=>Ge});var Ge=F((t=n(_),o=n(L))=>t.pipe(g(x.opened),f(e=>{let i=o.get("userLocalId");return[a.getFavouriteFilmsAction.action({payload:{userLocalId:i}})]})),{functional:!0}),He=F((t=n(_))=>t.pipe(g(x.closed),f(()=>[a.addFavouriteFilmAction.clearAction(),a.getFavouriteFilmsAction.clearAction()])),{functional:!0}),Ne=F((t=n(_))=>t.pipe(g(x.addFavouriteFilm),f(o=>[a.addFavouriteFilmAction.action({payload:{filmId:o.filmId,posterPath:o.posterPath,title:o.title,voteAverage:o.voteAverage,releaseDate:o.releaseDate,genres:o.genres,mediaType:o.mediaType}}),se.showToast({toastType:ae.Success,message:"\u0424\u0456\u043B\u044C\u043C \u0434\u043E\u0434\u0430\u043D\u043E \u0432 \u043E\u0431\u0440\u0430\u043D\u0435"})])),{functional:!0}),ze=F((t=n(_))=>t.pipe(g(x.deleteFavouriteFilm),f(o=>[a.deleteFavouriteFilmAction.action({payload:{userLocalId:o.userLocalId,filmId:o.filmId}}),se.showToast({toastType:ae.Info,message:"\u0424\u0456\u043B\u044C\u043C \u0432\u044B\u0434\u0430\u043B\u0435\u043D\u043E \u0437 \u043E\u0431\u0440\u0430\u043D\u043E\u0433\u043E"})])),{functional:!0}),qe=F((t=n(_),o=n(L))=>t.pipe(g(x.deleteAllFavourites),f(e=>[a.deleteAllFavouritesAction.action({payload:{userLocalId:e.userLocalId}})])),{functional:!0}),Je=F((t=n(_),o=n(L))=>t.pipe(g(x.deleteFavouritesByMediaType),f(e=>[a.deleteFavouritesByMediaTypeAction.action({payload:{userLocalId:e.userLocalId,mediaType:e.mediaType}})])),{functional:!0});var Qe=ge(Le.selectIsLoggedIn,$.selectFavouriteAll,$.selectFavouriteFilms,$.selectFavouriteTv,$.selectFavouriteIds,$.selectGetFavouriteAllAction,(t,o,e,i,r,m)=>({isLoggedIn:t,favouriteAll:o,favouriteFilms:e,favouriteTv:i,favouriteIds:r,isLoading:!be(m)})),Se={selectFavouriteViewModel:Qe};var Be=t=>w(B({},t),{results:t?.results.map(o=>({filmId:o.id,title:o.title||o.name,overview:o.overview,backdropPath:o.backdrop_path,posterPath:o.poster_path,voteAverage:o.vote_average,voteCount:o.vote_count,releaseDate:o.release_date||o.first_air_date,genreIds:o.genre_ids,genres:o.genre_names,mediaType:o.media_type}))}),We=(t,o,e,i)=>w(B({},Be(t)),{isShowFiltersButton:Ce(o,e,i)}),Xe=t=>t.reduce((o,e)=>(o[e]=null,o),{}),c={fromApiFilms:Be,fromApiDiscoverFilms:We,toApiFavouriteFilmIdsToDelete:Xe};var we=(()=>{class t{constructor(){this.tmdbAPIKey=Z.tmdbAPIKey,this.tmdbBaseFilmsUrlAPI=Z.tmdbBaseFilmsUrlAPI,this._httpClient=n(ie),this._injector=n(de)}getFilmDetails(e){return this._httpClient.get(`${this.tmdbBaseFilmsUrlAPI}${e.mediaType}/${e.filmId}?language=uk-UK&api_key=${this.tmdbAPIKey}&append_to_response=external_ids`).pipe(p(i=>Te.fromApiGetFilmDetails(i)))}getFilmActors(e){return this._httpClient.get(`${this.tmdbBaseFilmsUrlAPI}${e.mediaType}/${e.filmId}/credits?language=uk-UK&api_key=${this.tmdbAPIKey}`).pipe(p(i=>Ie.fromApiGetFilmActors(i)))}getTrendAllFilms(){return this._httpClient.get(`${this.tmdbBaseFilmsUrlAPI}trending/all/week?language=uk-UK&api_key=${this.tmdbAPIKey}`).pipe(p(e=>c.fromApiFilms(e)))}getTrendFilms(){return this._httpClient.get(`${this.tmdbBaseFilmsUrlAPI}trending/movie/week?language=uk-UK&api_key=${this.tmdbAPIKey}`).pipe(p(e=>c.fromApiFilms(e)))}getTrendTv(){return this._httpClient.get(`${this.tmdbBaseFilmsUrlAPI}trending/tv/week?language=uk-UK&api_key=${this.tmdbAPIKey}`).pipe(p(e=>c.fromApiFilms(e)))}getPopularFilmsHomeList(){return this._httpClient.get(`${this.tmdbBaseFilmsUrlAPI}discover/movie?language=uk-UK&page=1&sort_by=popularity.desc&vote_average.gte=8&with_origin_country=US&api_key=${this.tmdbAPIKey}`).pipe(p(e=>c.fromApiFilms(e)))}getPopularTvHomeList(){return this._httpClient.get(`${this.tmdbBaseFilmsUrlAPI}discover/tv?language=uk-UK&page=1&sort_by=popularity.desc&vote_average.gte=8&with_origin_country=US&api_key=${this.tmdbAPIKey}`).pipe(p(e=>c.fromApiFilms(e)))}getUpcomingFilms(){return this._httpClient.get(`${this.tmdbBaseFilmsUrlAPI}movie/upcoming?language=uk-UK&page=1&api_key=${this.tmdbAPIKey}`).pipe(p(e=>c.fromApiFilms(e)))}getPopularFilms(e){return this._httpClient.get(`${this.tmdbBaseFilmsUrlAPI}discover/${e}?include_adult=false&include_video=false&language=uk-UK&page=1&sort_by=vote_count.desc&api_key=${this.tmdbAPIKey}`).pipe(p(i=>c.fromApiFilms(i)))}getTopFilms(e){return this._httpClient.get(`${this.tmdbBaseFilmsUrlAPI}${e}/top_rated?include_adult=false&include_video=false&language=uk-UK&page=1&sort_by=popularity.desc&api_key=${this.tmdbAPIKey}`).pipe(p(i=>c.fromApiFilms(i)))}getGenresFilmsList(e){return this._httpClient.get(`${this.tmdbBaseFilmsUrlAPI}genre/${e}/list?language=uk-UK&api_key=${this.tmdbAPIKey}`)}discoverMedia(e){return this._httpClient.get(`${this.tmdbBaseFilmsUrlAPI}discover/${e.mediaType}?include_adult=false&include_video=false&language=uk-UK&page=${e.page}&sort_by=vote_count.desc&vote_average.gte=6&api_key=${this.tmdbAPIKey}`,{params:this._getDiscoverParams(e.mediaType,e.filters)}).pipe(p(i=>c.fromApiDiscoverFilms(i,this._injector,e.moviePage,e.route)))}getFilmsSimilar(e){return this._httpClient.get(`${this.tmdbBaseFilmsUrlAPI}${e.mediaType}/${e.filmId}/similar?language=uk-UK&api_key=${this.tmdbAPIKey}`).pipe(p(i=>c.fromApiFilms(i)))}searchFilms(e,i="multi",r=1){return this._httpClient.get(`${this.tmdbBaseFilmsUrlAPI}search/${i}?include_adult=false&language=uk-UK&page=${r}&api_key=${this.tmdbAPIKey}&query=${e}`).pipe(p(m=>c.fromApiFilms(m)))}getNowPlayingFilms(e){return this._httpClient.get(`${this.tmdbBaseFilmsUrlAPI}movie/now_playing?language=uk-UK&page=${e}&api_key=${this.tmdbAPIKey}`).pipe(p(i=>c.fromApiFilms(i)))}getAiringTodayTv(e){return this._httpClient.get(`${this.tmdbBaseFilmsUrlAPI}tv/airing_today?language=uk-UK&page=${e}&api_key=${this.tmdbAPIKey}`).pipe(p(i=>c.fromApiFilms(i)))}_getDiscoverParams(e,i){let r=new fe;return i?.genres&&(r=r.set("with_genres",i.genres)),i?.year&&(r=r.set(e===re.Movie?"primary_release_year":"first_air_date_year",i.year)),r}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=ee({token:t,factory:t.\u0275fac})}}return t})();var Ye=new te("FilmsProvider"),Jt=()=>D([{provide:Ye,useClass:we}]);var De=(()=>{class t{constructor(){this.firebaseDatabaseURL=Z.firebaseConfig.databaseURL,this._httpClient=n(ie)}toggleFavouriteFilm(e){return this._httpClient.put(`${this.firebaseDatabaseURL}/users/${e.userLocalId}/favouriteFilms/${e.filmId}.json`,{filmId:e.filmId,posterPath:e.posterPath,title:e.title,voteAverage:e.voteAverage,releaseDate:e.releaseDate,genres:e.genres,mediaType:e.mediaType})}getFavouriteFilms(e){return this._httpClient.get(`${this.firebaseDatabaseURL}/users/${e.userLocalId}/favouriteFilms.json`)}deleteFavouriteFilm(e){return this._httpClient.delete(`${this.firebaseDatabaseURL}/users/${e.userLocalId}/favouriteFilms/${e.filmId}.json`)}deleteAllFavourites(e){return this._httpClient.delete(`${this.firebaseDatabaseURL}/users/${e.userLocalId}/favouriteFilms.json`)}deleteFavouritesByMediaType(e){return this._httpClient.patch(`${this.firebaseDatabaseURL}/users/${e.userLocalId}/favouriteFilms.json`,c.toApiFavouriteFilmIdsToDelete(e.ids))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=ee({token:t,factory:t.\u0275fac})}}return t})();var S=new te("FavouriteProvider"),Ue=()=>D([{provide:S,useClass:De}]);var le={};pe(le,{handleAddFavouriteFilm:()=>Ze,handleDeleteAllFavourites:()=>it,handleDeleteFavouriteFilm:()=>tt,handleDeleteFavouritesByMediaType:()=>ot,handleGetFavouriteFilms:()=>et});var Ze=F((t=n(_),o=n(S),e=n(L))=>t.pipe(g(a.addFavouriteFilmAction.action),f(({payload:i})=>{let r=e.get("userLocalId");return z(o.toggleFavouriteFilm(w(B({},i),{userLocalId:r})),a.addFavouriteFilmAction)})),{functional:!0}),et=F((t=n(_),o=n(S),e=n(L))=>t.pipe(g(a.getFavouriteFilmsAction.action,a.deleteAllFavouritesAction.succeededAction,a.deleteFavouritesByMediaTypeAction.succeededAction,a.addFavouriteFilmAction.succeededAction,a.deleteFavouriteFilmAction.succeededAction),ue(1),f(()=>{let i=e.get("userLocalId");return z(o.getFavouriteFilms({userLocalId:i}),a.getFavouriteFilmsAction)})),{functional:!0}),tt=F((t=n(_),o=n(S))=>t.pipe(g(a.deleteFavouriteFilmAction.action),f(({payload:e})=>z(o.deleteFavouriteFilm(e),a.deleteFavouriteFilmAction))),{functional:!0}),it=F((t=n(_),o=n(S))=>t.pipe(g(a.deleteAllFavouritesAction.action),f(({payload:e})=>z(o.deleteAllFavourites(e),a.deleteAllFavouritesAction))),{functional:!0}),ot=F((t=n(_),o=n(S),e=n(oe))=>t.pipe(g(a.deleteFavouritesByMediaTypeAction.action),ce(e.select($.selectFavouriteFilms),e.select($.selectFavouriteTv)),f(([{payload:i},r,m])=>{let Re=Ae(i.mediaType,r,m);return z(o.deleteFavouritesByMediaType(w(B({},i),{ids:Re})),a.deleteFavouritesByMediaTypeAction)})),{functional:!0});var Me=()=>D([Ue(),he(Pe),xe([le,me])]);var Y=(()=>{class t{constructor(){this._store=n(oe),this.vm=_e(this._store.select(Se.selectFavouriteViewModel)),this.userLocalId=n(L).get("userLocalId"),this.filmsType=re,this.favouriteText=ne.favourites,this._favouriteFilmsService=n(ye)}ngOnInit(){this._store.dispatch(x.opened())}deleteAllFavourites(){this._store.dispatch(x.deleteAllFavourites({userLocalId:this.userLocalId}))}deleteFavouritesByMediaType(e){this._store.dispatch(x.deleteFavouritesByMediaType({userLocalId:this.userLocalId,mediaType:e}))}toggleFavouriteFilm(e){this._favouriteFilmsService.onToggleFavouriteFilm(e.filmId,e.posterPath,e.title,e.voteAverage,e.releaseDate,e.genres,e.mediaType,this.vm().favouriteIds,this.userLocalId)}ngOnDestroy(){this._store.dispatch(x.closed())}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=C({type:t,selectors:[["mm-favourites-base"]],decls:0,vars:0,template:function(i,r){},styles:[".favourite__button-clean[_ngcontent-%COMP%]{margin-bottom:20px}.favourite__list[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(224px,1fr));grid-row-gap:48px;grid-column-gap:24px}"]})}}return t})();function rt(t,o){if(t&1){let e=b();l(0,"mm-film-card",6),P("onAddFavouriteFilm",function(r){A(e);let m=s(3);return I(m.toggleFavouriteFilm(r))}),v()}if(t&2){let e=o.$implicit;s(3);let i=h(0);d("film",e)("mediaType",e.mediaType)("favouriteFilmsIds",i.favouriteIds)("isLoggedIn",i.isLoggedIn)("isInFavouritesPage",!0)}}function nt(t,o){if(t&1){let e=b();l(0,"button",2),P("click",function(){A(e);let r=s(2);return I(r.deleteAllFavourites())}),y(1,"mm-icon",3),l(2,"span"),k(3,"\u0412\u0438\u0434\u0430\u043B\u0438\u0442\u0438 \u0432\u0441\u0435"),v()(),l(4,"div",4),E(5,rt,1,5,"mm-film-card",5,K),v()}if(t&2){s(2);let e=h(0);u(5),j(e.favouriteAll)}}function at(t,o){if(t&1&&y(0,"ui-not-found",1),t&2){let e=s(2);d("text",e.favouriteText.notFoundAll)}}function st(t,o){if(t&1&&(O(0),T(1,nt,7,0)(2,at,1,1,"ui-not-found",1),R()),t&2){s();let e=h(0);u(),V(e.favouriteAll.length?1:2)}}var Ve=(()=>{class t extends Y{static{this.\u0275fac=(()=>{let e;return function(r){return(e||(e=U(t)))(r||t)}})()}static{this.\u0275cmp=C({type:t,selectors:[["mm-favourites-all"]],features:[M],decls:2,vars:2,consts:[[4,"uiSpinner"],[3,"text"],["mmButton","","mmType","quaternary","size","xxs",1,"favourite__button-clean",3,"click"],["iconName","close-red","size","m"],[1,"favourite__list"],[3,"film","mediaType","favouriteFilmsIds","isLoggedIn","isInFavouritesPage"],[3,"onAddFavouriteFilm","film","mediaType","favouriteFilmsIds","isLoggedIn","isInFavouritesPage"]],template:function(i,r){if(i&1&&(G(0),T(1,st,3,1,"ng-container",0)),i&2){let m=H(r.vm());u(),d("uiSpinner",m.isLoading)}},dependencies:[q,J,Q,W,N],styles:[".favourite__button-clean[_ngcontent-%COMP%]{margin-bottom:20px}.favourite__list[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(224px,1fr));grid-row-gap:48px;grid-column-gap:24px}"]})}}return t})();function mt(t,o){if(t&1){let e=b();l(0,"mm-film-card",6),P("onAddFavouriteFilm",function(r){A(e);let m=s(3);return I(m.toggleFavouriteFilm(r))}),v()}if(t&2){let e=o.$implicit;s(3);let i=h(0);d("film",e)("mediaType",e.mediaType)("favouriteFilmsIds",i.favouriteIds)("isLoggedIn",i.isLoggedIn)("isInFavouritesPage",!0)}}function lt(t,o){if(t&1){let e=b();l(0,"button",2),P("click",function(){A(e);let r=s(2);return I(r.deleteFavouritesByMediaType(r.filmsType.Movie))}),y(1,"mm-icon",3),l(2,"span"),k(3,"\u0412\u0438\u0434\u0430\u043B\u0438\u0442\u0438 \u0432\u0441\u0456 \u0444\u0456\u043B\u044C\u043C\u0438"),v()(),l(4,"div",4),E(5,mt,1,5,"mm-film-card",5,K),v()}if(t&2){s(2);let e=h(0);u(5),j(e.favouriteFilms)}}function pt(t,o){if(t&1&&y(0,"ui-not-found",1),t&2){let e=s(2);d("text",e.favouriteText.notFoundFilms)}}function ut(t,o){if(t&1&&(O(0),T(1,lt,7,0)(2,pt,1,1,"ui-not-found",1),R()),t&2){s();let e=h(0);u(),V(e.favouriteFilms.length?1:2)}}var Ke=(()=>{class t extends Y{static{this.\u0275fac=(()=>{let e;return function(r){return(e||(e=U(t)))(r||t)}})()}static{this.\u0275cmp=C({type:t,selectors:[["mm-favourites-films"]],features:[M],decls:2,vars:2,consts:[[4,"uiSpinner"],[3,"text"],["mmButton","","mmType","quaternary","size","xxs",1,"favourite__button-clean",3,"click"],["iconName","close-red","size","m"],[1,"favourite__list"],[3,"film","mediaType","favouriteFilmsIds","isLoggedIn","isInFavouritesPage"],[3,"onAddFavouriteFilm","film","mediaType","favouriteFilmsIds","isLoggedIn","isInFavouritesPage"]],template:function(i,r){if(i&1&&(G(0),T(1,ut,3,1,"ng-container",0)),i&2){let m=H(r.vm());u(),d("uiSpinner",m.isLoading)}},dependencies:[N,q,J,Q,W],styles:[".favourite__button-clean[_ngcontent-%COMP%]{margin-bottom:20px}.favourite__list[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(224px,1fr));grid-row-gap:48px;grid-column-gap:24px}"]})}}return t})();function ct(t,o){if(t&1){let e=b();l(0,"mm-film-card",6),P("onAddFavouriteFilm",function(r){A(e);let m=s(3);return I(m.toggleFavouriteFilm(r))}),v()}if(t&2){let e=o.$implicit;s(3);let i=h(0);d("film",e)("mediaType",e.mediaType)("favouriteFilmsIds",i.favouriteIds)("isLoggedIn",i.isLoggedIn)("isInFavouritesPage",!0)}}function dt(t,o){if(t&1){let e=b();l(0,"button",2),P("click",function(){A(e);let r=s(2);return I(r.deleteFavouritesByMediaType(r.filmsType.Tv))}),y(1,"mm-icon",3),l(2,"span"),k(3,"\u0412\u0438\u0434\u0430\u043B\u0438\u0442\u0438 \u0432\u0441\u0456 \u0441\u0435\u0440\u0456\u0430\u043B\u0438"),v()(),l(4,"div",4),E(5,ct,1,5,"mm-film-card",5,K),v()}if(t&2){s(2);let e=h(0);u(5),j(e.favouriteTv)}}function vt(t,o){if(t&1&&y(0,"ui-not-found",1),t&2){let e=s(2);d("text",e.favouriteText.notFoundTv)}}function ft(t,o){if(t&1&&(O(0),T(1,dt,7,0)(2,vt,1,1,"ui-not-found",1),R()),t&2){s();let e=h(0);u(),V(e.favouriteTv.length?1:2)}}var Ee=(()=>{class t extends Y{static{this.\u0275fac=(()=>{let e;return function(r){return(e||(e=U(t)))(r||t)}})()}static{this.\u0275cmp=C({type:t,selectors:[["mm-favourites-tv"]],features:[M],decls:2,vars:2,consts:[[4,"uiSpinner"],[3,"text"],["mmButton","","mmType","quaternary","size","xxs",1,"favourite__button-clean",3,"click"],["iconName","close-red","size","m"],[1,"favourite__list"],[3,"film","mediaType","favouriteFilmsIds","isLoggedIn","isInFavouritesPage"],[3,"onAddFavouriteFilm","film","mediaType","favouriteFilmsIds","isLoggedIn","isInFavouritesPage"]],template:function(i,r){if(i&1&&(G(0),T(1,ft,3,1,"ng-container",0)),i&2){let m=H(r.vm());u(),d("uiSpinner",m.isLoading)}},dependencies:[q,J,Q,W,N],styles:[".favourite__button-clean[_ngcontent-%COMP%]{margin-bottom:20px}.favourite__list[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(224px,1fr));grid-row-gap:48px;grid-column-gap:24px}"]})}}return t})();var je=[{title:"\u0412\u0441\u0456",route:"/favourites/all"},{title:"\u0424\u0456\u043B\u044C\u043C\u0438",route:"/favourites/movies"},{title:"\u0421\u0435\u0440\u0456\u0430\u043B\u0438",route:"/favourites/tv"}];var Oe=(()=>{class t{constructor(){this.favouriteTabs=je,this.favouriteText=ne.favourites}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=C({type:t,selectors:[["mm-favourites"]],decls:5,vars:3,consts:[[1,"container"],["mmTitle","",1,"favourite__title",3,"level"],[1,"favourite__tabset",3,"tabs"]],template:function(i,r){i&1&&(l(0,"div",0)(1,"h2",1),k(2),v(),y(3,"ui-route-tabset",2)(4,"router-outlet"),v()),i&2&&(u(),d("level",2),u(),ve(r.favouriteText.title),u(),d("tabs",r.favouriteTabs))},dependencies:[$e,ke,Fe],styles:["[_nghost-%COMP%]{display:block;padding-top:120px}.favourite__title[_ngcontent-%COMP%]{color:var(--color-title-text);text-align:center}.favourite__tabset[_ngcontent-%COMP%]{margin-bottom:40px}"]})}}return t})();var Eo=[{path:"favourites",component:Oe,children:[{path:"all",component:Ve},{path:"movies",component:Ke},{path:"tv",component:Ee},{path:"",redirectTo:t=>t.queryParams.type||"all",pathMatch:"full"}],providers:[Me()]}];export{Ye as a,Jt as b,Ge as c,He as d,Ne as e,ze as f,qe as g,Je as h,Se as i,Me as j,Y as k,Ve as l,Ke as m,Ee as n,je as o,Oe as p,Eo as q};
