import{a as Te}from"./chunk-GXM7V3JA.js";import{a as W}from"./chunk-BS6CDHGN.js";import{c as H,d as K}from"./chunk-Z3WLGFDH.js";import{a as Fe}from"./chunk-MCQSURPA.js";import{$ as D,$a as ve,D as le,E,G as pe,H as he,I as Q,Ka as q,La as y,Pa as _e,Qa as N,Ra as X,S as u,T as ue,Ua as Y,Wa as Z,_ as w,aa as O,ba as de,bb as j,ga as d,hb as Se,ia as C,ib as U,la as fe,pa as R,qb as ge,rb as G,x as me,y as ce}from"./chunk-3ZWTIYMJ.js";import{Aa as oe,C as ie,Fc as se,Ha as _,Ia as v,Mb as S,Mc as V,Nc as b,Oa as re,Oc as x,Pc as ae,Sb as g,Wc as M,Xc as B,_a as ne,a as te,ac as a,d as Ve,fc as A,hd as k,ja as J,kc as f,lc as h,mc as F,nc as I,oc as P,qc as L,sc as T,tc as m,wa as o,zb as l}from"./chunk-5NRRMIXO.js";var be="Search",c=he({source:be,events:{opened:pe(),closed:Q(),searchClickedAfterLoad:Q()}});var p=class{constructor(){this._store=o(u),this.searchName=ne(null)}setTerm(s){this.searchName.set(s)}openPage(s,e,i){this._store.dispatch(c.opened({mediaType:s,nameFilm:e,page:i}))}loadFilms(s,e,i){this._store.dispatch(y.searchFilms({page:e,name:i,mediaType:s}))}};var xe=[{title:"\u0424\u0456\u043B\u044C\u043C\u0438",route:"/search/movies"},{title:"\u0421\u0435\u0440\u0456\u0430\u043B\u0438",route:"/search/tv"}];var ye=(()=>{class t{constructor(){this.queryParams={},this.searchTabs=xe,this._destroyRef=o(re),this._searchService=o(p),this._route=o(me),this._store=o(u)}ngOnInit(){this._route.queryParams.pipe(le(this._destroyRef)).subscribe(e=>{this.nameFilm=e.name,this.queryParams=te({},e),this._searchService.setTerm(this.nameFilm)})}searchFilms(e){this.nameFilm!==e?this._store.dispatch(y.goToSearchPage({name:e})):this._store.dispatch(c.searchClickedAfterLoad())}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=S({type:t,selectors:[["mm-search"]],features:[ae([p])],decls:6,vars:6,consts:[[1,"mm-search__container","container"],["mmTitle","",1,"mm-search__title",3,"level"],[3,"inputedSearchFilms","placeholder","hasSearchButton","searchTerm"],[1,"mm-search__tabset",3,"tabs","queryParams"]],template:function(i,r){i&1&&(f(0,"div",0)(1,"h2",1),se(2,"\u041F\u043E\u0448\u0443\u043A \u043F\u043E \u0441\u0430\u0439\u0442\u0443"),h(),f(3,"ui-search-input",2),T("inputedSearchFilms",function(Le){return r.searchFilms(Le)}),h(),F(4,"ui-route-tabset",3)(5,"router-outlet"),h()),i&2&&(l(),a("level",2),l(2),a("placeholder","\u041F\u043E\u0448\u0443\u043A...")("hasSearchButton",!0)("searchTerm",r.nameFilm),l(),a("tabs",r.searchTabs)("queryParams",r.queryParams))},dependencies:[ce,Fe,Te,ge],styles:["[_nghost-%COMP%]{display:block;padding-top:95px}.mm-search__container[_ngcontent-%COMP%]{padding-top:60px}.mm-search__title[_ngcontent-%COMP%]{margin-bottom:84px}.mm-search__tabset[_ngcontent-%COMP%]{margin-top:60px}"]})}}return t})();var Me=ue(ve.selectIsLoggedIn,Y.selectUpdatedSearchFilms,Z.selectFavouriteIds,Y.selectSearchFilmsAction,Z.selectGetFavouriteAllAction,(t,s,e,i,r)=>({isLoggedIn:t,searchFilms:s,favouriteFilmsIds:e,isLoading:!_e(i&&r)})),z={selectSearchViewModel:Me};function ke(t,s){if(t&1){let e=L();f(0,"mm-films-list",3),T("clickedPaginationBtn",function(r){_(e);let n=m(2);return v(n.loadSearchFilms(r,n.nameFilm()))})("clickedFavouriteButton",function(r){_(e);let n=m(2);return v(n.toggleFavouriteFilm(r,n.mediaType.Movie))}),h()}if(t&2){let e=m(2),i=x(0);a("films",i.searchFilms)("isVisibleTitle",!1)("isLoggedIn",i.isLoggedIn)("mediaType",e.mediaType.Movie)("favouriteFilmsIds",i.favouriteFilmsIds)("currentPage",e.currentPage)}}function Ee(t,s){if(t&1&&(F(0,"ui-not-found",2),M(1,"translate")),t&2){let e=m(2);a("text",B(1,1,e.searchTexts.notFoundFilms))}}function we(t,s){if(t&1&&(I(0),g(1,ke,1,6,"mm-films-list",1)(2,Ee,2,3,"ui-not-found",2),P()),t&2){m();let e=x(0);l(),A(e.searchFilms!=null&&e.searchFilms.results.length?1:2)}}var Ae=(()=>{class t{constructor(){this._store=o(u),this.vm=E(this._store.select(z.selectSearchViewModel)),this.nameFilm=k(()=>this._searchService.searchName()),this.mediaType=d,this.searchTexts=j.search,this.userLocalId=o(C).get("userLocalId"),this._searchService=o(p),this._favouriteFilmsService=o(R)}ngOnInit(){this._searchService.openPage(d.Movie,this.nameFilm(),1)}loadSearchFilms(e,i){this.currentPage=e,this._searchService.loadFilms(d.Movie,e,i)}toggleFavouriteFilm(e,i){this._favouriteFilmsService.onToggleFavouriteFilm(e.filmId,e.posterPath,e.title,e.voteAverage,e.releaseDate,e.genres,i,this.vm().favouriteFilmsIds,this.userLocalId)}ngOnDestroy(){this._store.dispatch(c.closed())}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=S({type:t,selectors:[["mm-search-films"]],decls:2,vars:2,consts:[[4,"uiSpinner"],[3,"films","isVisibleTitle","isLoggedIn","mediaType","favouriteFilmsIds","currentPage"],[3,"text"],[3,"clickedPaginationBtn","clickedFavouriteButton","films","isVisibleTitle","isLoggedIn","mediaType","favouriteFilmsIds","currentPage"]],template:function(i,r){if(i&1&&(V(0),g(1,we,3,1,"ng-container",0)),i&2){let n=b(r.vm());l(),a("uiSpinner",n.isLoading)}},dependencies:[q,G,W,K,H],encapsulation:2})}}return t})();function De(t,s){if(t&1){let e=L();f(0,"mm-films-list",3),T("clickedPaginationBtn",function(r){_(e);let n=m(2);return v(n.loadSearchTv(r,n.nameFilm()))})("clickedFavouriteButton",function(r){_(e);let n=m(2);return v(n.toggleFavouriteFilm(r,n.mediaType.Tv))}),h()}if(t&2){let e=m(2),i=x(0);a("films",i.searchFilms)("isLoggedIn",i.isLoggedIn)("mediaType",e.mediaType.Tv)("favouriteFilmsIds",i.favouriteFilmsIds)("isVisibleTitle",!1)("currentPage",e.currentPage)}}function Oe(t,s){if(t&1&&(F(0,"ui-not-found",2),M(1,"translate")),t&2){let e=m(2);a("text",B(1,1,e.searchTexts.notFoundFilms))}}function Re(t,s){if(t&1&&(I(0),g(1,De,1,6,"mm-films-list",1)(2,Oe,2,3,"ui-not-found",2),P()),t&2){m();let e=x(0);l(),A(e.searchFilms!=null&&e.searchFilms.results.length?1:2)}}var Ie=(()=>{class t{constructor(){this._store=o(u),this.vm=E(this._store.select(z.selectSearchViewModel)),this.nameFilm=k(()=>this._searchService.searchName()),this.mediaType=d,this.searchTexts=j.search,this.userLocalId=o(C).get("userLocalId"),this._searchService=o(p),this._favouriteFilmsService=o(R)}ngOnInit(){this._searchService.openPage(d.Tv,this.nameFilm(),1)}loadSearchTv(e,i){this.currentPage=e,this._searchService.loadFilms(d.Tv,e,i)}toggleFavouriteFilm(e,i){this._favouriteFilmsService.onToggleFavouriteFilm(e.filmId,e.posterPath,e.title,e.voteAverage,e.releaseDate,e.genres,i,this.vm().favouriteFilmsIds,this.userLocalId)}ngOnDestroy(){this._store.dispatch(c.closed())}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=S({type:t,selectors:[["mm-search-tv"]],decls:2,vars:2,consts:[[4,"uiSpinner"],[3,"films","isLoggedIn","mediaType","favouriteFilmsIds","isVisibleTitle","currentPage"],[3,"text"],[3,"clickedPaginationBtn","clickedFavouriteButton","films","isLoggedIn","mediaType","favouriteFilmsIds","isVisibleTitle","currentPage"]],template:function(i,r){if(i&1&&(V(0),g(1,Re,3,1,"ng-container",0)),i&2){let n=b(r.vm());l(),a("uiSpinner",n.isLoading)}},dependencies:[G,W,q,K,H],encapsulation:2})}}return t})();var ee={};Ve(ee,{handleClosedSearchPage:()=>Ne,handleSearchInputClicked:()=>je,loadSearchPage:()=>qe});var qe=w((t=o(D),s=o(C))=>t.pipe(O(c.opened),J(e=>{let i=s.get("userLocalId");return[U.setIsSearchBlockVisible({isVisible:!1}),U.setIsSearchBtnVisible({isVisible:!1}),N.genresAction.action({payload:{mediaType:e.mediaType}}),y.searchFilms({page:e.page,name:e.nameFilm,mediaType:e.mediaType}),X.getFavouriteFilmsAction.action({payload:{userLocalId:i}})]})),{functional:!0}),Ne=w((t=o(D))=>t.pipe(O(c.closed),J(()=>[U.setIsSearchBtnVisible({isVisible:!0}),N.genresAction.clearAction(),N.searchFilmsAction.clearAction(),X.getFavouriteFilmsAction.clearAction()])),{functional:!0}),je=w((t=o(D))=>t.pipe(O(c.searchClickedAfterLoad),ie(()=>Se.showToast({toastType:fe.Warning,message:"\u0417\u0430\u043F\u0456\u0442 \u043D\u0430 \u043E\u0442\u0440\u0438\u043C\u0430\u043D\u043D\u044F \u0444\u0456\u043B\u044C\u043C\u0456\u0432 \u0432\u0436\u0435 \u0437\u0440\u043E\u0431\u043B\u0435\u043D\u0438\u0439!"}))),{functional:!0});var Pe=()=>oe([de([ee])]);var Fi=[{path:"",component:ye,children:[{path:"movies",component:Ae},{path:"tv",component:Ie},{path:"",redirectTo:t=>t.queryParams.category||"movies",pathMatch:"full"}],providers:[Pe()]}];export{ye as SearchComponent,Fi as routes};
